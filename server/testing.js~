
var v = require('validator');
var db = require('mongo_schemas');
var _ = require('lodash');
var encrypt = require('encrypt');


//function asyncLoop(iterations, func, callback ,foo) {
//    var done = false;
//    var loop = {
//        next: function() {
//            if (done) {return;}
//            if (iterations) {func(loop);}
//            else {
//                done = true;
//                if(callback) callback(foo);
//            }
//        },
//
//        refresh : function(it){
//            iterations = it ;
//        },
//
//        iteration: function() {
//            return index - 1;
//        },
//
//        break: function() {
//            done = true;
//            callback();
//        }
//    };
//    loop.next();
//    return loop;
//}
//
//
//function bfs (_id ,callback){
//    _id = String(_id);
//    var q = [] ,res = [] ;
//
//    db.tasks.findOne({ _id : _id }).lean().exec(function(err,root){
//        root.depth = 0 ;
//        q.push(root);
//
//        asyncLoop(q.length ,function(loop){
//            res.push(q[0]);
//            db.tasks.find({ _parent : q[0]._id }).lean().exec(function(err,new_nodes){
//                if(err) console.log(err);
//                else {
//                    var d = q[0].depth ;
//                    q.shift();
//                    loop.refresh(new_nodes.length + q.length);
//                    if(new_nodes.length > 0){
//                        new_nodes.forEach(function(new_node){
//                            new_node.depth = d+1 ;
//                            q.push(new_node);
//                        });
//                    }
//                    loop.next();
//                }
//            });
//
//        },function(){ callback(res) });
//    });
//}
////
//bfs("550a9ae8498f262a6ef5d26e",function(rrr){
//    console.open(rrr);
//});
//

// todo : 1

//db.users.find().lean().exec(function(err,users){
//    String.sync_for(users.length,function(loop){
//        var user = users[loop.iteration()] ;
//
//        for( var i = 0 ; i < user.age_group_decide.length ; i++ ){
//            if( user.age_group_decide[i] == "elementary" ) user.age_group_decide[i] = "ابتدایی" ;
//            if( user.age_group_decide[i] == "secondary" ) user.age_group_decide[i] = "راهنمایی" ;
//            if( user.age_group_decide[i] == "high_school" ) user.age_group_decide[i] = "دبیرستان" ;
//        }
//
//        db.users.update({ _id : user._id },user,function(err){
//            if(err) console.log(err);
//            loop.next();
//        });
//    },function(){
//        console.log("Done");
//    });
//});

// todo : 2

//new db.tasks({
//    title : "عضو شورا" ,
//    name : "shora" ,
//    permissions : [
//        "add_user" ,
//        "users_report",
//        "add_dispatch" ,
//        "dispatch_report" ,
//        "add_cost",
//        "mali_report"
//    ]
//}).save(function(err,_root){
//        if(err) console.log(err);
//        else if (_root){
//            console.log(_root.name);
//        }
//    });
//
//
//
//
//new db.tasks({
//    title : "امور انسانی خانم ها" ,
//    name : "female ensani" ,
//    permissions : [
//        "add_user" ,
//        "define_task_child" ,
//        "add_user" ,
//        "see_all_woman_users" ,
//        "can_edit",
//        "see_all_woman_users_notification"
//    ]
//}).save(function(err,_root){
//        if(err) console.log(err);
//        else if (_root){
//            console.log(_root.name);
//        }
//    });
//
//
//
//
//new db.tasks({
//    title : "وظیفه موقتی" ,
//    name : "temp" ,
//    permissions : [
//        "add_user" ,
//    ]
//}).save(function(err,_root){
//        if(err) console.log(err);
//        else if (_root){
//            console.log(_root.name);
//        }
//    });

// todo : 3 add task_ids by my hands


// todo : 4
//function user_adders (id){
//    db.users.find().lean().exec(function(err,users){
//        String.sync_for(users.length,function(loop){
//            if( users[loop.iteration()].password && users[loop.iteration()].task.length == 0 ){
//                users[loop.iteration()].task.push(id);
//            }
//            db.users.update({ _id : users[loop.iteration()]._id },users[loop.iteration()],function(err,res){
//                if(err) console.log(err);
//                if (res) console.open(res);
//                loop.next();
//            });
//        },function(){
//            console.log("Done");
//        });
//    });
//}

//user_adders("552535e452d23a043fe6c00c");

//db.users.find().lean().exec(function(err,res){
//    res.forEach(function(user){
//        if(user.task && user.task.length > 0) console.log(user.last_name);
//    });
//});



//var a = "22" ;
//
//var b = {};
//b[a] = "3";
//
//console.open(b);





//function AJAX (url,data,success,error){
//    $.ajax({
//        url : url ,
//        data : data ,
//        type : "POST",
//        success : function(d){
//            if(d.session == false ){
//                window.location.replace('/');
//            } else if (success) {
//                success(d);
//            }
//        },
//        error : function(err){
//            if (error){
//                error(err);
//            }
//        }
//    })
//}
//
//var url = "/" ;
//var data = { username : "mostafa" , password : "123" };
//
//AJAX(url,data,function(res){
//    if(res.ok == true){
//        // success
//    } else {
//    }
//},function(err){
//    // error
//});

//var a = [{ a : 1  , b : 2}] ;
//var b = [{ a : 3 , b : 5 }] ;
//console.open(a.concat(b));

// var send_sms = require('send_sms_log');
//
// db.users.find({ birth_date : { $exists : true } },{ _id : false , birth_date : true ,mobile : true ,first_name : true , last_name : true }).lean().exec(function(err,users){
//     console.log(users.length);
//     var cntr = 0 ;
//     users.forEach(function(user){
//
//         var birth_date = new Date(user.birth_date);
//         var date = new Date();
//
//         if(){
//             cntr++ ;
//         }
//
//         if(birth_date.getMonth() == date.getMonth() && date.getDate() == birth_date.getDate() ){
//             console.log("sending birthDay SMS -> " + user.first_name + " " + user.last_name)
//             send_sms({ text : "" , to : user.mobile },"sending",function(){});
//         }
//     });
//
//     console.log(cntr);
// });




//
// var request = require('request');
//
//
// var fff = function(){
// 	console.log("in");
//     var headers = {
//                 'User-Agent': 'Mozilla/5.0 (Windows NT 6.3; rv:36.0) Gecko/20100101 Firefox/36.0',
//                 'Content-Type': 'application/x-www-form-urlencoded'
//             };
//
//     var options = {
//         url: 'http://localhost:3030/users',
//         method: 'post',
//         headers: headers,
//         data : { from : 0 , to : 10 }
// 		}
//
//         request(options, function (error, response, body) {
// 	        if (!error && response) {
// 				console.open(response);
// 	        } else {
// 				console.log(error);
// 			}
//     	})
//     }
//
//
// setTimeout(fff(),1000);

// module.export = fff ;


// var a = "w" ;
//
// if(Number(a) === a){
//     console.log(true);
// } else {
//     console.log(false);
// }
// var send_sms = require('send_sms_log');
//
//
// var t = "قطره قطره های باران جمع شدند و باریدن گرفتند..." + "\n" +
//                 "تولد هر قطره تولد مهری ست دوباره..."  + "\n" +
//                 "لبخند بارانیت به زندگی دست های کوچکم رنگ دیگر داد.." + "\n" +
//                 "معلم مهر، فرشته ی عشق زادروزت مبارک!" + "\n" +
//                 "گروه دانشجویی باران" ;
//
//

// var t = "گروه دانشجویی باران تقدیم میکند:" + "\n" + "سمینار دکتر معماریان باموضوع مدیریت زمان" + "\n" + "دوشنبه ۲۱ اردیبهشت" + "\n" + "۱۱:۳۰ تا ۱۲:۳۰" + "\n" + "آمفی تئاتر دانشگاه سجاد" ;

// send_sms({ text : t  , to : "09366877798"  },"sending",function(){});


// sending SMS

// var t = "برای کودک پدر واژه بیگانه ای میشود گاهی.." + "\n" +
// 		"آن زمان اگرآشنایی باشد،" + "\n" +
// "آن آشنا مردانگی های بارانی توست.." + "\n" +
// "روزت مبارک فرشته سیبیلو!" + "\n" +
// "گروه دانشجویی باران"


//
// var t = "معلمی شغل انبیاست و معلم کودکان مهر و آفتاب بودن،کاری ست برتر و والاتر... . با اندیشه های کودکانه ی شان تا اوج سفر کردن و انگیزه ای هر چند کوچک در قلبشان نهادن.." + "\n" +
// 		"معلم بارانی روزت مبارک"
//

// db.users.find().lean().exec(function(err,users){
//     console.log(users.length);
//     users.forEach(function(user){
//         // console.log(String.dec_mobile(user.mobile));
//         send_sms({ text : t  , to : String.dec_mobile(user.mobile) },"sending",function(){});
//     });
// });

// send_sms({ text : t  , to : "09366877798" },"sending",function(){});

//
// var a = "علی" ;
//
// var query = {} ;
// query.first_name = new RegExp(a);
//
//
// db.users.find( query ).lean().exec(function(err,r){
// 	// console.log(r.length);
// });


// var s_sms = require('send_sms');
//
// s_sms.account_info(function(data){
// 	console.open(data);
// });
