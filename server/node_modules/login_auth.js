
var bcrypt = require('bcrypt');

module.exports = (function () {
    return function (username, password,cb) {
        cb = cb || function(){};
        if(username){
            db.users.findOne({ mobile : String.enc_mobile(String.remove_space(user.username)) },{},
                function (err, contact) {
                if (contact) {
                    encrypt.compare(user.password, contact.password, function (ok) {
                        if (ok) {
                            cb({ auth : true ,username : true , password : true });
                            db.users.update({ _id: contact._id }, { $set: { _site_log : new Date() }},function(err){
                                if(err) console.log(err);
                            });
                        } else {
                            cb({ auth : false ,username : true , password : false });
                        }
                    });
                } else {
                    cb({ auth : true ,username : false , password : false });
                }
            });

        }
    };
})();