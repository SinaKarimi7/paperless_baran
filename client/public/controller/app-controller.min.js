/*!
*   BaranGroup System v0.0.16
*   Author: Mehran Arjmand & Elyas Ghasemi
*   Website: Baran Group <http://barang.ir>
*   License: Open source - GNU
!*/

function setBirthDate(a){if(a.birth_date){var b=a.birth_date;b=b.split("/"),a.birth_year=b[0],a.birth_month=b[1],a.birth_day=b[2],delete a.birth_date}return a}function choose(a){return a[Math.floor(Math.random()*a.length)]}function trimArray(a,b){if(void 0!=a)for(var c=a.length-1;c>=0;c--)b?(null==a[c][b]||""==a[c][b])&&a.splice(c,1):(null==a[c]||""==a[c])&&a.splice(c,1)}function getGravatar(a){var b="mm";b=encodeURIComponent(b);var c=200;return a?"http://1.gravatar.com/avatar/"+md5(a)+"?d="+b+"&s="+c:"http://1.gravatar.com/avatar/?d="+b+"&s="+c}var app=angular.module("Baran",["ngRoute","ngProgress"]);app.controller("MainController",["$scope","$http","$location","$timeout","toaster","ngProgressFactory","ngProgress",function(a,b,c,d,e,f){a.progressbar=f.createInstance(),a.majorsList=[{name:"\u0646\u0631\u0645 \u0627\u0641\u0632\u0627\u0631",group:"\u06a9\u0627\u0645\u067e\u06cc\u0648\u062a\u0631"},{name:"\u0633\u062e\u062a \u0627\u0641\u0632\u0627\u0631",group:"\u06a9\u0627\u0645\u067e\u06cc\u0648\u062a\u0631"},{name:"\u0622\u06cc \u062a\u06cc",group:"\u06a9\u0627\u0645\u067e\u06cc\u0648\u062a\u0631"},{name:"\u06a9\u0627\u0631\u062f\u0627\u0646\u06cc",group:"\u06a9\u0627\u0645\u067e\u06cc\u0648\u062a\u0631"},{name:"\u0642\u062f\u0631\u062a",group:"\u0628\u0631\u0642"},{name:"\u0627\u0644\u06a9\u062a\u0631\u0648\u0646\u06cc\u06a9",group:"\u0628\u0631\u0642"},{name:"\u06a9\u0646\u062a\u0631\u0644",group:"\u0628\u0631\u0642"},{name:"\u0645\u062e\u0627\u0628\u0631\u0627\u062a",group:"\u0628\u0631\u0642"},{name:"\u0645\u0647\u0646\u062f\u0633\u06cc \u067e\u0632\u0634\u06a9\u06cc",group:"\u0645\u0647\u0646\u062f\u0633\u06cc"},{name:"\u0639\u0645\u0631\u0627\u0646",group:"\u0645\u0647\u0646\u062f\u0633\u06cc"},{name:"\u0645\u06a9\u0627\u0646\u06cc\u06a9",group:"\u0645\u0647\u0646\u062f\u0633\u06cc"},{name:"\u0635\u0646\u0627\u06cc\u0639",group:"\u0645\u0647\u0646\u062f\u0633\u06cc"},{name:"\u0645\u0648\u0627\u062f",group:"\u0645\u0647\u0646\u062f\u0633\u06cc"},{name:"\u0645\u0639\u0645\u0627\u0631\u06cc",group:""},{name:"\u0646\u0642\u0634\u0647 \u0628\u0631\u062f\u0627\u0631\u06cc",group:""},{name:"\u0634\u06cc\u0645\u06cc",group:""},{name:"\u0646\u0642\u0627\u0634\u06cc",group:""},{name:"\u06af\u0631\u0627\u0641\u06cc\u06a9",group:""},{name:"\u0639\u06a9\u0627\u0633\u06cc",group:""},{name:"\u0627\u062f\u0628\u06cc\u0627\u062a \u0641\u0627\u0631\u0633\u06cc",group:""},{name:"\u0627\u0644\u0647\u06cc\u0627\u062a",group:""},{name:"\u062d\u0642\u0648\u0642",group:""},{name:"\u062d\u0633\u0627\u0628\u062f\u0627\u0631\u06cc",group:""},{name:"\u062f\u0646\u062f\u0627\u0646\u067e\u0632\u0634\u06a9\u06cc",group:""},{name:"\u0641\u0646 \u0622\u0648\u0631\u06cc \u0627\u0637\u0644\u0627\u0639\u0627\u062a \u0633\u0644\u0627\u0645\u062a",group:""}],a.lessonsList=["\u0639\u0631\u0628\u06cc","\u0641\u0644\u0633\u0641\u0647","\u0632\u06cc\u0633\u062a \u0634\u0646\u0627\u0633\u06cc","\u0632\u0628\u0627\u0646 \u062e\u0627\u0631\u062c\u0647","\u0645\u0639\u0645\u0627\u0631\u06cc","\u0631\u06cc\u0627\u0636\u06cc\u0627\u062a","\u0634\u06cc\u0645\u06cc","\u0641\u06cc\u0632\u06cc\u06a9","\u06af\u0631\u0627\u0641\u06cc\u06a9","\u062d\u0633\u0627\u0628\u062f\u0627\u0631\u06cc"],a.agesList=["\u0627\u0628\u062a\u062f\u0627\u06cc\u06cc","\u0631\u0627\u0647\u0646\u0645\u0627\u06cc\u06cc","\u062f\u0628\u06cc\u0631\u0633\u062a\u0627\u0646"],a.freeTimes={days:[{title:"\u0634\u0646\u0628\u0647",value:"saturday"},{title:"\u06cc\u06a9\u0634\u0646\u0628\u0647",value:"sunday"},{title:"\u062f\u0648\u0634\u0646\u0628\u0647",value:"monday"},{title:"\u0633\u0647 \u0634\u0646\u0628\u0647",value:"tuesday"},{title:"\u0686\u0647\u0627\u0631\u0634\u0646\u0628\u0647",value:"wednesday"},{title:"\u067e\u0646\u062c\u0634\u0646\u0628\u0647",value:"thursday"},{title:"\u062c\u0645\u0639\u0647",value:"friday"}],hours:[{from:8,to:10},{from:10,to:12},{from:12,to:14},{from:14,to:16},{from:16,to:18},{from:18,to:20}]},a.entryYear=[];for(var h=1380;h<=1394;h++)a.entryYear.push(h);a.page={},a.user={},a.messages=[],a.menus=[],a.showModal="none",a.count=0,b.post("/page_data").success(function(b){a.user=b.user,a.messages=b.messages,a.menus=b.menus,a.notifications=b.notifications,a.page=b.page,a.version=b.version}).error(function(a,b){e.error("error!\nError Code"+b)}),a.getMenuLinkClass=function(a){return"#"+c.url()==a?"active":null},a.getFullName=function(a){var b="";return a.first_name&&(b=a.first_name+" "),a.last_name&&(b+=a.last_name),b},a.backToDashboard=function(){c.path("/")},a.getMessageTitle=function(){return a.messages&&a.messages.length>0?"\u0634\u0645\u0627 "+a.messages.length+" \u067e\u06cc\u0627\u0645 \u062c\u062f\u06cc\u062f \u062f\u0627\u0631\u06cc\u062f":"\u067e\u06cc\u0627\u0645 \u062c\u062f\u06cc\u062f\u06cc \u0648\u062c\u0648\u062f \u0646\u062f\u0627\u0631\u062f."},a.getNotificationTitle=function(){return a.notifications&&a.notifications.length>0?a.notifications.length+" \u0627\u0639\u0644\u0627\u0645\u06cc\u0647":"\u0627\u0639\u0644\u0627\u0645\u06cc\u0647 \u0627\u06cc \u0648\u062c\u0648\u062f \u0646\u062f\u0627\u0631\u062f."}}]).controller("DashboardController",["$scope","$http","$sce","toaster",function(a,b,c,d){a.quote={style:"bg-green-gradient",text:"\u0645\u06cc\u062f\u0648\u0646\u0633\u062a\u06cc \u0628\u0627 \u062e\u0631\u06cc\u062f \u0634\u0627\u0631\u0698 \u0627\u0632 \u0633\u0627\u06cc\u062a \u06a9\u0627\u0631\u062a \u0634\u0627\u0631\u0698 \u0628\u0627\u0631\u0627\u0646 \u0628\u062c\u0632 \u0627\u0633\u062a\u0641\u0627\u062f\u0647 \u0627\u0632 \u062e\u062f\u0645\u0627\u062a \u0634\u0627\u0631\u0698 \u063a\u06cc\u0631 \u0645\u0633\u062a\u0642\u06cc\u0645 \u0648 \u0634\u0627\u0631\u0698 \u0648\u0627\u06cc\u0645\u06a9\u0633 \u0645\u06cc\u062a\u0648\u0646\u06cc \u062a\u0648 \u0634\u0627\u062f \u06a9\u0631\u062f\u0646 \u0628\u0686\u0647 \u0647\u0627\u06cc \u0648\u06cc\u0698\u0647 \u0647\u0645 \u0645\u0627 \u0631\u0648 \u0647\u0645\u0631\u0627\u0647\u06cc \u06a9\u0646\u06cc.",title:null,link:"http://charge.barang.ir",author:null},a.quote.text=c.trustAsHtml(a.quote.text),a.vote={header:{title:"\u0646\u0638\u0631 \u0633\u0646\u062c\u06cc",icon:"fa-ticket"},question:"\u0686\u0647 \u0646\u0627\u0645\u06cc \u0631\u0627 \u0628\u0631\u0627\u06cc \u0633\u0627\u06cc\u062a \u067e\u06cc\u0634\u0646\u0647\u0627\u062f \u0645\u06cc\u06a9\u0646\u06cc\u062f\u061f",answer:"",isSending:!1},a.getNews=function(){b.get("/news").success(function(b){a.news=b}).error(function(){d.error("\u062e\u0637\u0627 \u062f\u0631 \u0628\u0627\u0631\u06af\u0630\u0627\u0631\u06cc \u0627\u062e\u0628\u0627\u0631")})},a.sendVote=function(){a.vote.isSending=!0;var c={text:"voting for "+a.vote.question+" is "+a.vote.answer,allow_writer:!0};b.post("/feedback",c).success(function(){a.vote.isSending=!1,a.vote.answer="",d.success("\u0645\u0645\u0646\u0648\u0646\u060c \u0631\u0627\u06cc \u0634\u0645\u0627 \u0628\u0627 \u0645\u0648\u0641\u0642\u06cc\u062a \u062b\u0628\u062a \u0634\u062f.")}).error(function(){a.vote.isSending=!1,d.error("\u0645\u062a\u0633\u0627\u0641\u0627\u0646\u0647 \u0628\u0647 \u0645\u0634\u06a9\u0644 \u0628\u0631\u062e\u0648\u0631\u062f\u06cc\u0645 \u0644\u0637\u0641\u0627 \u062f\u0648\u0628\u0627\u0631\u0647 \u062a\u0644\u0627\u0634 \u06a9\u0646\u06cc\u062f")})},a.getNews()}]).controller("LogController",["$scope","$http","$interval","$routeParams",function(a,b,c,d){a.logsLength=d.size,a.isLoading=!1,a.autoReload=!1,a.getLogs=function(){a.isLoading=!0,b.get("/logs_"+a.logsLength).success(function(b){a.isLoading=!1,a.logs=b.reverse()}).error(function(){toaster.error("\u062e\u0637\u0627 \u062f\u0631 \u062f\u0631\u06cc\u0627\u0641\u062a \u0627\u0637\u0644\u0627\u0639\u0627\u062a"),a.isLoading=!1})},a.getLogs(),c(function(){a.autoReload&&a.getLogs()},3e3)}]).controller("ProfileController",["$scope","$http","toaster",function(a,b,c){a.isSending=!1,b.get("/my_data").success(function(b){a.userCopy=b}).error(function(){c.error("\u062e\u0637\u0627 \u062f\u0631 \u0628\u0627\u0631\u06af\u0630\u0627\u0631\u06cc \u0627\u0637\u0644\u0627\u0639\u0627\u062a")}),a.removeSkill=function(b){a.userCopy.skills&&a.userCopy.skills.splice(b,1)},a.addSkill=function(){a.userCopy.skills||(a.userCopy.skills=[]),a.userCopy.skills.push("")},a.hasError=function(){return a.profileForm.$error.required||a.profileForm.email.$invalid||a.profileForm.mobile.$invalid||a.userCopy.password!=a.passwordRepeat},a.editUser=function(){a.hasError()||a.isSending||(setBirthDate(a.userCopy),trimArray(a.userCopy.skills),a.isSending=!0,b.post("/my_data",a.userCopy).success(function(b){b.edit&&(c.success("\u067e\u0631\u0648\u0641\u0627\u06cc\u0644 \u0634\u0645\u0627 \u0628\u0627 \u0645\u0648\u0641\u0642\u06cc\u062a \u0628\u0631\u0648\u0632\u0631\u0633\u0627\u0646\u06cc \u06af\u0631\u062f\u06cc\u062f"),a.isSending=!1,a.userCopy=b.data)}).error(function(b,d){c.error("\u0645\u062a\u0627\u0633\u0641\u0627\u0646\u0647 \u062f\u0631 \u0627\u0631\u0633\u0627\u0644 \u0627\u0637\u0644\u0627\u0639\u0627\u062a \u062e\u0637\u0627\u06cc\u06cc \u0631\u062e \u062f\u0627\u062f\u0647.\n\u06a9\u062f \u062e\u0637\u0627: "+d),a.isSending=!1}))},a.commitFreeTimes=function(){console.log(a.userCopy.freeTimes)},a.getMajorValue=function(a){return a.group?a.group+"-"+a.name:a.name},a.showPassword=function(a){$("#"+a).attr("type","text")},a.hidePassword=function(a){$("#"+a).attr("type","password")},a.getPasswordStrength=function(){a.passwordStrength=0,a.userCopy.password.length>5&&(a.passwordStrength+=20),/[0-9].*[0-9]/.test(a.userCopy.password)&&(a.passwordStrength+=30),/[~,!,@,#,$,_,%,^,&,*]/.test(a.userCopy.password)&&(a.passwordStrength+=30),a.userCopy.password.length>20&&(a.passwordStrength+=20)}}]).controller("AddContactController",["$scope","$http",function(a,b){a.Deactive=!1,a.contact={gender:!0,skills:[],_comments:[]},a.reset=function(){a.contact={gender:!0,skills:[],_comments:[]},a.myForm.$setUntouched()},a.submits=function(){a.hasError()||(a.Deactive=!0,a.contact.birth_date&&setBirthDate(a.contact),trimArray(a.contact.skills),trimArray(a.contact._comments,"comment"),b.post("/new_user",a.contact).success(function(b){1==b.add?(toaster.info("\u0627\u0637\u0644\u0627\u0639\u0627\u062a \u0634\u0645\u0627 \u0628\u0627 \u0645\u0648\u0641\u0642\u06cc\u062a \u062b\u0628\u062a \u0634\u062f"),a.reset()):1==b.exists?toaster.error("\u0634\u0645\u0627\u0631\u0647 \u062a\u0644\u0641\u0646 \u062f\u0631 \u0633\u0627\u06cc\u062a \u0645\u0648\u062c\u0648\u062f \u0627\u0633\u062a"):0==b.have_permission?toaster.info("\u0634\u0645\u0627 \u0645\u062c\u0627\u0632 \u0628\u0647 \u0627\u0631\u0633\u0627\u0644 \u0627\u06cc\u0646 \u062f\u0631\u062e\u0648\u0627\u0633\u062a \u0646\u06cc\u0633\u062a\u06cc\u062f"):toaster.error("\u0627\u0637\u0644\u0627\u0639\u0627\u062a \u0645\u0639\u062a\u0628\u0631 \u0646\u06cc\u0633\u062a\u0646\u062f"),a.Deactive=!1}).error(function(){toaster.error("\u062e\u0637\u0627 \u062f\u0631 \u0628\u0631\u0642\u0631\u0627\u0631\u06cc \u0627\u0631\u062a\u0628\u0627\u0637 \u0628\u0627 \u0633\u0631\u0648\u0631"),a.Deactive=!1}))},a.hasError=function(){return a.myForm.$error.required||a.myForm.email.$invalid||a.myForm.mobile.$invalid},a.getMajorValue=function(a){return a.group?a.group+"-"+a.name:a.name}}]).controller("ContactListController",["$scope","$http","$timeout","toaster",function(a,b,c,d){a.Deactive=!1,a.isLoading=!1,a.isSending=!1,a.selectedUser=null,a.datatable={totalCount:0,indicators:[],indicatorSize:0,currentPage:-1,listSize:10},b.post("/users").success(function(b){a.canEdit=b.can_edit,a.paging(1)}).error(function(a,b){d.error("error!\nError Code"+b)}),a.selectUser=function(b){a.selectedUser=null==a.selectedUser||a.selectedUser._id!=b._id?angular.copy(b):null},a.getMajorValue=function(a){return a.group?a.group+"-"+a.name:a.name},a.paging=function(c,e){return isNaN(c)||c>a.datatable.maxPage&&!e||c<=0?void(a._page=a.datatable.currentPage):e||c!=a.datatable.currentPage?(a.isLoading=!0,void b.post("/users",{from:String((c-1)*a.datatable.listSize),to:String(c*a.datatable.listSize),query:a.query}).success(function(b){a.selectedUser=null,a.datatable.totalCount=b.count,a.datatable.maxPage=Math.ceil(a.datatable.totalCount/a.datatable.listSize),a.datatable.currentPage=Number(c),a.users=b.data,a._page=a.datatable.currentPage,a.isLoading=!1}).error(function(b,c){d.info("error!\nError Code"+c),a.isLoading=!1})):void(a._page=a.datatable.currentPage)},a.hasError=function(){return a.myForm.$error.required||a.myForm.email.$invalid||a.myForm.mobile.$invalid},a.editUser=function(c){if(!a.hasError()){if(trimArray(c.skills),trimArray(c._comments,"comment"),c&&c._comments)for(var e=0;e<c._comments.length;e++)c._comments[e]._writer&&c._comments.splice(e--,1);setBirthDate(c),a.isSending=!0,b.post("/edit_users",c).success(function(b){d.info(1==b.exists?"\u0634\u0645\u0627\u0631\u0647 \u062a\u0644\u0641\u0646 \u0648\u0627\u0631\u062f \u0634\u062f\u0647 \u062f\u0631 \u0633\u06cc\u0633\u062a\u0645 \u0645\u0648\u062c\u0648\u062f \u0627\u0633\u062a!":b.edit?"\u06a9\u0627\u0631\u0628\u0631 \u0645\u0648\u0631\u062f \u0646\u0638\u0631 \u0648\u06cc\u0631\u0627\u06cc\u0634 \u06af\u0631\u062f\u06cc\u062f":"\u0648\u06cc\u0631\u0627\u06cc\u0634 \u0646\u0634\u062f!"),a.selectedUser=null,a.paging(a.datatable.currentPage,!0),a.isSending=!1}).error(function(){d.info("\u062e\u0637\u0627 \u062f\u0631 \u0627\u0631\u062a\u0628\u0627\u0637 \u0628\u0627 \u0633\u0631\u0648\u0631"),a.isSending=!1})}},a.removeComment=function(b,c){a.canEdit&&!b._comments[c]._writer&&b._comments.splice(c,1)},a.addComment=function(b){a.canEdit&&(b._comments||(b._comments=[]),b._comments.push({}))},a.removeSkill=function(b,c){a.canEdit&&b.skills.splice(c,1)},a.addSkill=function(b){a.canEdit&&(b.skills||(b.skills=[]),b.skills.push(""))},a.search=function(){""==a._query.quick_search&&a.clearSearch(),a.selectedUser=null,a.query=angular.copy(a._query),a._query=null,a.paging(1,!0)},a.clearSearch=function(){a.query=null,a._query=null,a.paging(1,!0)},a.RemoveCriteria=function(b){delete a.query[b],a.paging(1,!0)}}]).controller("SendFeedBackController",["$scope","$http","toaster",function(a,b,c){a.isSending=!1,a.Deactive=!1,a.sendFeedBack=function(){a.isSending=!0,b.post("/feedback",a.feedback).success(function(){a.isSending=!1,c.success("\u067e\u06cc\u0627\u0645 \u0634\u0645\u0627 \u0628\u0627 \u0645\u0648\u0641\u0642\u06cc\u062a \u0627\u0631\u0633\u0627\u0644 \u0634\u062f."),a.backToDashboard()}).error(function(){a.isSending=!1,c.error("\u0627\u0631\u0633\u0627\u0644 \u0628\u0627 \u062e\u0637\u0627 \u0645\u0648\u0627\u062c\u0647 \u0634\u062f.")})}}]).controller("BugReportController",["$scope","$http","toaster",function(a,b,c){a.isSending=!1,a.sendBug=function(){if(a.bug){a.isSending=!0;var d={text:"["+a.bug.text+"] \u062f\u0631 \u0642\u0633\u0645\u062a ["+a.bug.section+"]",allow_writer:!0};b.post("/feedback",d).success(function(){c.success("\u062f\u0631\u062e\u0648\u0627\u0633\u062a \u0634\u0645\u0627 \u0627\u0631\u0633\u0627\u0644 \u0634\u062f."),a.isSending=!1,a.backToDashboard()}).error(function(b,d){c.error("\u0627\u0631\u0633\u0627\u0644 \u0628\u0627 \u062e\u0637\u0627 \u0645\u0648\u0627\u062c\u0647 \u0634\u062f.\n\u06a9\u062f \u062e\u0637\u0627: "+d),a.isSending=!1})}}}]).controller("BirthdaySmsController",["$scope","$http","toaster",function(a,b,c){$isSending=!1,a.maxCharCount=70,a.smsSetting={text:""},a.getSMSCount=function(){return Math.ceil(a.smsSetting.text.length/a.maxCharCount)},b.get("/birthday_sms").success(function(b){a.smsSetting=b}).error(function(){c.error("\u062e\u0637\u0627 \u062f\u0631 \u062f\u0631\u06cc\u0627\u0641\u062a \u0627\u0637\u0644\u0627\u0639\u0627\u062a")}),a.saveSetting=function(){a.isSending=!0,b.post("/birthday_sms",a.smsSetting).success(function(){a.isSending=!1,c.success("\u062a\u0646\u0638\u06cc\u0645\u0627\u062a \u0628\u0627 \u0645\u0648\u0641\u0642\u06cc\u062a \u0630\u062e\u06cc\u0631\u0647 \u0634\u062f."),a.backToDashboard()}).error(function(){a.isSending=!1,c.error("\u062f\u0631 \u0627\u0631\u0633\u0627\u0644 \u0628\u0627 \u062e\u0637\u0627 \u0645\u0648\u0627\u062c\u0647 \u0634\u062f\u06cc\u0645")})}}]).controller("UserReportController",["$scope","$http","$sce","$filter","toaster",function(a,b,c,d,e){a.report=[],b.get("/users_report").success(function(b){a.drawChart(b.report_by_year)}).error(function(a,b){e.error("\u062e\u0637\u0627 \u062f\u0631 \u0628\u0627\u0631\u06af\u0630\u0627\u0631\u06cc \u0627\u0637\u0644\u0627\u0639\u0627\u062a\n\u06a9\u062f \u062e\u0637\u0627: "+b)}),a.drawChart=function(b){data={labels:[],datasets:[]};var e=!0,f=["#3c8dbc","#00c0ef","#00a65a","#f39c12","#f56954","#605ca8","#D81B60","#001F3F"],g=0;angular.forEach(b,function(a,b){data.datasets.push({label:b,fillColor:f[g],strokeColor:f[g],highlightFill:f[g],highlightStroke:f[g],data:[]}),angular.forEach(a,function(a,b){data.datasets[data.datasets.length-1].data.push(a),e&&data.labels.push(d("farsimal")(b))}),e=!1,g=(g+1)%f.length});var h=$("#reportChart").get(0).getContext("2d"),i=data,j={scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,responsive:!0,datasetFill:!0,legendTemplate:'<ul class="nav nav-pills nav-stacked no-padding"><% for (var i=0; i<datasets.length; i++){%><li><a><i class="fa fa-circle pull-left" style="color:<%=datasets[i].fillColor%>"></i> <span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></span></a></li><%}%></ul>',maintainAspectRatio:!1};a.reportByYearChart={chart:null,legend:null},a.reportByYearChart.chart=new Chart(h).Bar(i,j),a.reportByYearChart.legend=c.trustAsHtml(a.reportByYearChart.chart.generateLegend())}}]).controller("SubmitDispatchController",["$scope","$http","toaster",function(a,b,c){a.DefaultDispatch=function(){return{costs:[]}},a.isLoading=!0,b.get("/new_dispatch").success(function(b){a.isLoading=!1,a.Stations=b.stations}).error(function(){a.isLoading=!1,c.error("\u062e\u0637\u0627 \u0631\u062f \u062f\u0631\u06cc\u0627\u0641\u062a \u0644\u06cc\u0633\u062a \u0645\u0631\u0627\u06a9\u0632")}),a.SendDispatch=function(){a.hasError()||(trimArray(a.dispatch.costs,"cost"),a.isSending=!0,b.post("/new_dispatch",a.dispatch).success(function(){a.isSending=!1,c.success("\u062b\u0628\u062a \u0627\u0639\u0632\u0627\u0645 \u0645\u0648\u0641\u0642\u06cc \u0622\u0645\u06cc\u0632 \u0628\u0648\u062f."),a.backToDashboard()}).error(function(){a.isSending=!1,c.error("\u062e\u0637\u0627 \u062b\u0628\u062a \u0627\u0639\u0632\u0627\u0645.")}))},a.hasError=function(){return a.SubmitDispatchForm.$invalid},a.dispatch=a.DefaultDispatch()}]).controller("StationController",["$scope","$http","toaster",function(a,b,c){a.DefaultStation=function(){return{phone_numbers:[""]}},a.GetStations=function(){a.isLoading=!0,b.post("/station",{type:"list"}).success(function(b){a.isLoading=!1,a.StationList=b}).error(function(){a.isLoading=!1,c.error("\u062e\u0637\u0627 \u062f\u0631 \u062f\u0631\u06cc\u0627\u0641\u062a \u0644\u06cc\u0633\u062a \u0645\u0631\u0627\u06a9\u0632")})},a.AddStation=function(d){a.hasError()||(trimArray(d.phone_numbers),a.isSending=!0,b.post("/station",{type:"add",data:d}).success(function(b){a.isSending=!1,b.add?(a.StationList.push(b.data),c.success("\u0645\u0631\u06a9\u0632 \u0628\u0627 \u0645\u0648\u0641\u0642\u06cc\u062a \u0627\u0636\u0627\u0641\u0647 \u0634\u062f."),a.SelectedStation=null):c.error("\u062e\u0637\u0627 \u062f\u0631 \u0630\u062e\u06cc\u0631\u0647 \u0627\u0637\u0644\u0627\u0639\u0627\u062a \u0645\u0631\u06a9\u0632.")}).error(function(){a.isSending=!1,c.error("\u062e\u0637\u0627 \u062f\u0631 \u0630\u062e\u06cc\u0631\u0647 \u0627\u0637\u0644\u0627\u0639\u0627\u062a \u0645\u0631\u06a9\u0632.")}))},a.EditStation=function(d){a.hasError()||(trimArray(d.phone_numbers),a.isSending=!0,b.post("/station",{type:"edit",data:d}).success(function(b){a.isSending=!1,b.edit?(c.success("\u0645\u0631\u06a9\u0632 \u0628\u0627 \u0645\u0648\u0641\u0642\u06cc\u062a \u0648\u06cc\u0631\u0627\u06cc\u0634 \u0634\u062f."),a.SelectedStation=null):c.error("\u062e\u0637\u0627 \u062f\u0631 \u0648\u06cc\u0631\u0627\u06cc\u0634 \u0645\u0631\u06a9\u0632.")}).error(function(){a.isSending=!1,c.error("\u062e\u0637\u0627 \u062f\u0631 \u0648\u06cc\u0631\u0627\u06cc\u0634 \u0645\u0631\u06a9\u0632.")}))},a.selectStation=function(b){(null==a.SelectedStation||a.SelectedStation._id!=b._id)&&(a.SelectedStation=angular.copy(b),a._type="edit",a.AddStationForm.$setPristine())},a.hasError=function(){return a.AddStationForm.$invalid||!a.SelectedStation.male&&!a.SelectedStation.female||a.SelectedStation.age_from>a.SelectedStation.age_to&&!a.SelectedStation.phone_numbers[0]},a.GetStations()}]).controller("MaliReportController",["$scope","$http","toaster",function(a,b,c){a.init=function(){a.isLoading=!0,a.selected=null,b.get("/mali",{params:{type:"list"}}).success(function(b){a.isLoading=!1,a.finance=b}).error(function(){a.isLoading=!1,c.error("\u062e\u0637\u0627 \u062f\u0631 \u0628\u0627\u0631\u06af\u0632\u0627\u0631\u06cc.")})},a.selectRow=function(d){a.selected&&d._id==a.selected._id||(a.selected=d,b.get("/mali",{params:{type:"get_data",_id:d._id}}).success(function(b){a.selected=b}).error(function(){c.error("\u062e\u0637\u0627\u06cc \u0633\u0631\u0648\u0631.")}))},a.init()}]).controller("DispatchReportController",["$scope","$http","toaster",function(a,b,c){a.init=function(){a.isLoading=!0,a.selected=!1,b.get("/dispatch",{params:{type:"list"}}).success(function(b){a.isLoading=!1,a.dispatches=b}).error(function(){a.isLoading=!1,c.error("\u062e\u0637\u0627\u06cc \u062e\u0648\u0627\u0646\u062f\u0646 \u0627\u0637\u0644\u0627\u0639\u0627\u062a")})},a.selectRow=function(d){a.selected&&a.selected._id==d._id||(a.selected=d,b.get("/dispatch",{params:{type:"get_data",_id:d._id}}).success(function(b){a.selected=b}).error(function(){c.error("\u062e\u0637\u0627\u06cc \u0633\u0631\u0648\u0631.")}))},a.init()}]).controller("SendSmsController",["$scope","$http","toaster",function(a,b,c){a.sms={text:"",contacts:{}},a.isLoading=!1,a.maxCharCount=70,a.getPanelDetail=function(){a.isLoading=!0,b.get("/send_sms").success(function(b){a.isLoading=!1,a.panel=b})},a.getSMSCount=function(){return Math.ceil(a.sms.text.length/a.maxCharCount)},a.sendSMS=function(){return a.sms.contacts.gender&&(a.sms.contacts.gender.female||a.sms.contacts.gender.male)?void b.post("/send_sms",a.sms).success(function(a){1==a.send?c.success(a.count+" \u067e\u06cc\u0627\u0645 \u0628\u0627 \u0645\u0648\u0641\u0642\u06cc\u062a \u0627\u0631\u0633\u0627\u0644 \u0634\u062f."):c.error("\u062e\u0637\u0627 \u062f\u0631 \u0627\u0631\u0633\u0627\u0644")}).error(function(){c.error("\u0645\u062a\u0627\u0633\u0641\u0627\u0646\u0647 \u062f\u0631 \u062d\u0627\u0644 \u062d\u0627\u0638\u0631 \u0642\u0627\u062f\u0631 \u0628\u0647 \u0627\u0631\u0633\u0627\u0644 \u067e\u06cc\u0627\u0645\u06a9 \u0646\u06cc\u0633\u062a\u06cc\u0645\u060c \u0644\u0637\u0641\u0627 \u062f\u0648\u0628\u0627\u0631\u0647 \u062a\u0644\u0627\u0634 \u06a9\u0646\u06cc\u062f.")}):void c.warning("\u0644\u0637\u0641\u0627 \u062d\u062f\u0627\u0642\u0644 \u06cc\u06a9 \u062c\u0646\u0633\u06cc\u062a \u0631\u0627  \u0627\u0646\u062a\u062e\u0627\u0628 \u0646\u0645\u0627\u06cc\u06cc\u062f.")},a.getPanelDetail()}]).controller("TaskAssignController",["$scope","$http","toaster",function(a,b,c){a.getTasks=function(){a.isLoading=!0,b.get("/tasks").success(function(b){a.taskList=b,a.taskList=a.sortTasksRecursive(a.taskList),a.isLoading=!1}).error(function(){c.error("\u062f\u0631\u06cc\u0627\u0641\u062a \u0644\u06cc\u0633\u062a \u0648\u0638\u0627\u06cc\u0641 \u0628\u0627 \u0645\u0634\u06a9\u0644 \u0645\u0648\u0627\u062c\u0647 \u0634\u062f."),a.isLoading=!1})},a.init=function(){a.isLoading=!0,a.getTasks(),a.task={members:[]},$("#input-member").tokenInput("clear"),angular.forEach(a.task.members,function(a){$("#input-member").tokenInput("add",{_id:a._id,name:a.name})}),a.isLoading=!1},a.sortTasksRecursive=function(b,c,d){if(!c)var c=[];for(var e=0;e<b.length;e++)if(b[e]._parent==d){var f=b.splice(e,1)[0];c.push(f),a.sortTasksRecursive(b,c,f._id),e--}return c},a.hasError=function(){return a.taskForm.$invalid},a.getTaskTitle=function(a){return s.repeat("-",2*a.depth)+" "+a.title},a.assigntask=function(){a.hasError()||(a.isSending=!0,b.post("/task_members",a.task).success(function(){a.isSending=!1,a.init(),c.success("\u0628\u0627 \u0645\u0648\u0641\u0642\u062a \u062b\u0628\u062a \u0634\u062f.")}).error(function(){a.isSending=!1,c.error("\u0628\u0627 \u062e\u0637\u0627 \u0645\u0648\u0627\u062c\u0647 \u0634\u062f.")}))},a.init()}]).controller("NewsController",["$scope","$http","toaster",function(a,b,c){a.init=function(){a.news={},a.newsForm.$setPristine(),a.isSending=!1},a.hasError=function(){return a.newsForm.$invalid},a.addNews=function(d){a.hasError()||(a.isSending=!0,b.post("/news",{type:"add",data:d}).success(function(b){return a.isSending=!1,b.err?void c.error("\u0628\u0627 \u062e\u0637\u0627 \u0645\u0648\u0627\u062c\u0647 \u0634\u062f."):(a.init(),void c.success("\u0628\u0627 \u0645\u0648\u0641\u0642\u062a \u062b\u0628\u062a \u0634\u062f."))}).error(function(){a.isSending=!1,c.error("\u0628\u0627 \u062e\u0637\u0627 \u0645\u0648\u0627\u062c\u0647 \u0634\u062f.")}))}}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/dashboard.html",controller:"DashboardController"}).when("/profile",{templateUrl:"views/profile.html",controller:"ProfileController"}).when("/contact_list",{templateUrl:"views/contact-list.html",controller:"ContactListController"}).when("/new-user",{templateUrl:"views/add-contact.html",controller:"AddContactController"}).when("/logs/:size",{templateUrl:"views/log.html",controller:"LogController"}).when("/birthday-sms",{templateUrl:"views/birthday-sms.html",controller:"BirthdaySmsController"}).when("/send-sms",{templateUrl:"views/send-sms.html",controller:"SendSmsController"}).when("/users-report",{templateUrl:"views/users-report.html",controller:"UserReportController"}).when("/task-assign",{templateUrl:"views/task-assign.html",controller:"TaskAssignController"}).when("/submit-dispatch",{templateUrl:"views/submit-dispatch.html",controller:"SubmitDispatchController"}).when("/news",{templateUrl:"views/news.html",controller:"NewsController"}).when("/stations",{templateUrl:"views/stations.html",controller:"StationController"}).when("/mali",{templateUrl:"views/mali-report.html",controller:"MaliReportController"}).when("/dispatch",{templateUrl:"views/dispatch-report.html",controller:"DispatchReportController"}).when("/bug-report",{templateUrl:"views/bug-report.html",controller:"BugReportController"}).when("/feedback",{templateUrl:"views/send-feedback.html",controller:"SendFeedBackController"}).when("/faq",{templateUrl:"views/faq.html"}).when("/under-construct",{templateUrl:"views/under-construct.html"}).when("/404",{templateUrl:"views/404.html"}).when("/403",{templateUrl:"views/403.html"}).otherwise({redirectTo:"/404"})}]),app.factory("toaster",["$rootScope","$timeout",function(a,b){return a.alerts=[],{success:function(b){a.alerts.push({cssClass:"alert-success",description:b}),console.log(b),this.startDestroyer(2500)},error:function(b){a.alerts.push({cssClass:"alert-danger",description:b}),this.startDestroyer(2500)},info:function(b){a.alerts.push({cssClass:"alert-info",description:b}),this.startDestroyer(2500)},startDestroyer:function(c){b(function(){a.alerts.shift()},c)}}}]),app.run(["$rootScope","ngProgressFactory","toaster",function(a,b,c){a.progressbar=b.createInstance(),a.progressbar.setParent(document.getElementById("wrapper")),a.progressbar.setColor("#F0AD4E"),a.progressbar.setHeight("3px"),a.progressbar.setAbsolute(),a.$on("$routeChangeStart",function(){a.progressbar.start()}),a.$on("$routeChangeSuccess",function(){a.progressbar.complete()}),a.$on("$routeChangeError",function(){a.progressbar.stop(),c.error("\u062e\u0637\u0627 \u062f\u0631 \u0628\u0631\u0642\u0631\u0627\u0631\u06cc \u0627\u0631\u062a\u0628\u0627\u0637...")})}]),app.directive("datatable",function(){return{scope:{rows:"=",columns:"=",selected:"=?",emptyTemplate:"@",pageSize:"=",total:"="},restrict:"E",replace:!0,template:"hello world",link:function(){}}}),app.filter("farsimal",function(){return function(a){if(a){for(var b=[{en:"true",fa:"\u0628\u0644\u0647"},{en:"false",fa:"\u062e\u06cc\u0631"},{en:"male",fa:"\u0645\u0631\u062f"},{en:"female",fa:"\u0632\u0646"},{en:"all_active",fa:"\u0641\u0639\u0627\u0644"},{en:"",fa:""}],c=0;c<b.length;c++){if(a===!0)return"\u0628\u0644\u0647";if(a===!1)return"\u062e\u06cc\u0631";if(a.toLowerCase()==b[c].en.toLowerCase())return b[c].fa}return a}}}).filter("fullname",function(){return function(a){var b="";return a.first_name&&(b=a.first_name+" "),a.last_name&&(b+=a.last_name),b}}).filter("toman",function(){return function(a){return a+" \u062a\u0648\u0645\u0627\u0646"}});